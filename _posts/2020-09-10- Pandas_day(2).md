---
title: "Pandas ì •ë¦¬ day(2)"
date: 2020-09-18 18:29:00 +0900
categories: Development



---

ê¸¸ê³  ê¸´ Pandasì˜ ìë£Œêµ¬ì¡°...ì´ì œ ë“œë””ì–´ DataFrameì´ë‹¤!!

### 1. Pandasì˜ ìë£Œ êµ¬ì¡° - DataFrame(2ì°¨ì›)

#### 1) DataFrameì˜ ìƒì„±

PandasëŠ” NumPyì˜ ndarrayë¥¼ ê¸°ë³¸ ìë£Œ êµ¬ì¡°ë¡œ ì´ìš©í•˜ëŠ”ë°,

ì•„ë˜ì˜ Pandasë§Œì˜ ìë£Œêµ¬ì¡°ë¥¼ ì´ìš©í•œë‹¤ê³  ì €ë²ˆì—ë„ ì„¤ëª…í–ˆë‹¤.

* Series : ë™ì¼í•œ ë°ì´í„° íƒ€ì…ì˜ ë³µìˆ˜ê°œì˜ ì„±ë¶„ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ” ìë£Œêµ¬ì¡° (1ì°¨ì›)
* DataFrame : ì—‘ì…€ì—ì„œ Tableê³¼ ê°™ì€ ê°œë…. Databaseì˜ Tableê³¼ ê°™ì€ ê°œë…. Seriesë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. (2ì°¨ì›)

ğŸ‘‡ì´ë²ˆì—ëŠ” 2ì°¨ì› ìë£Œêµ¬ì¡°ì¸ DataFrameì— ëŒ€í•´ ì•Œì•„ë³´ì!ğŸ‘‡

DataFrameì€ dictionaryë¥¼ ê°€ì§€ê³  ë§Œë“œëŠ”ë°, dictionaryì˜ keyê°€ DataFrameì˜ columnìœ¼ë¡œ ë“¤ì–´ê°€ê²Œ ëœë‹¤. 

`DataFrameì€ Seriesì˜ ì§‘í•©`ì´ë‹¤. ì¦‰ `ê°ê°ì˜ columnì´ Series`ì´ë‹¤.



```python
import numpy as np
import pandas as pd

# dictionary ìƒì„±
data = { 'names':['ì•„ì´ìœ ', 'ì²­í•˜', 'ê¹€ì—°ì•„', 'ì´íš¨ë¦¬', 'í™”ì‚¬'],
         'year' :[2015, 2019, 2020, 2013, 2017],
         'point':[3.5, 1.5, 2.9, 4.0, 3.7] }

# DataFrameì„ ìƒì„±í•´ë³´ì
df = pd.DataFrame(data)

# DataFrameì„ ì¶œë ¥í•  ë•ŒëŠ” display()ë¥¼ ì´ìš©í•´ì„œ ì¶œë ¥í•œë‹¤

display(df)
```



![20-09-10-img(1)](/assets/images/post/development/200910/20-09-10-img(1).jpg)



Seriesì™€ ë‹¤ë¥´ê²Œ DataFrameì€ í‘œ ëª¨ì–‘ìœ¼ë¡œ ì¶œë ¥ëœë‹¤. ë˜í•œ dictionaryì—ì„œ ì…ë ¥í•œ keyê°€ columnìœ¼ë¡œ ë“¤ì–´ê°„ ê²ƒë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

DataFrameë„ ì°¨ì›ê³¼ ìš”ì†Œì˜ ê°¯ìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```python
print(df.shape) # tupleë¡œ í‘œí˜„ëœë‹¤. (5, 3)
print(df.size)  # ì „ì²´ ìš”ì†Œì˜ ê°¯ìˆ˜ : 15
print(df.ndim)  # ì°¨ì› : 2
```





#### 2) DataFrameì˜ index, values, columns

ìœ„ì—ì„œ ë§Œë“  DataFrameì˜ index, value, column ì •ë³´ë¥¼ í™•ì¸í•´ë³´ì.

```python
data = { 'names':['ì•„ì´ìœ ', 'ì²­í•˜', 'ê¹€ì—°ì•„', 'ì´íš¨ë¦¬', 'í™”ì‚¬'],
         'year' :[2015, 2019, 2020, 2013, 2017],
         'point':[3.5, 1.5, 2.9, 4.0, 3.7] }


df = pd.DataFrame(data)

print(df.index)   
# RangeIndex(start=0, stop=5, step=1)

print(df.columns) 
# Index(['names', 'year', 'point'], dtype='object')
# columnì€ ë°ì´í„°íƒ€ì…ì´ ê°ì²´ì´ë‹¤!!

print(df.values)
# [['ì•„ì´ìœ ' 2015 3.5]
#  ['ì²­í•˜' 2019 1.5]
#  ['ê¹€ì—°ì•„' 2020 2.9]
#  ['ì´íš¨ë¦¬' 2013 4.0]
#  ['í™”ì‚¬' 2017 3.7]]
# 2ì°¨ì› ndarrayë¡œ ë‚˜ì˜¨ë‹¤

# DataFrameë„ indexì™€ columnì— ì´ë¦„ì„ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤
df.index.name = 'í•™ë²ˆ'
df.columns.name = 'í•™ìƒì •ë³´'


```



### 2. DataFrameì„ ìƒì„±í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•

#### 1) CSV íŒŒì¼ì„ ì´ìš©í•˜ì—¬ ìƒì„±

1. ë°ì´í„°ê°€ ë“¤ì–´ìˆëŠ” csv íŒŒì¼ì„ í•˜ë‚˜ êµ¬í•œë‹¤
2. ì£¼í”¼í„° ë…¸íŠ¸ë¶ ì›Œí‚¹ ë””ë ‰í† ë¦¬ê°€ ìƒì„±ëœ í´ë”ì— í•˜ìœ„ í´ë”ë¥¼ ìƒì„±í•œë‹¤.(ë‚˜ëŠ” data ë¼ëŠ” ì´ë¦„ì˜ í´ë”ë¥¼ ìƒì„±í–ˆë‹¤!) 
3. 1ì˜ csv íŒŒì¼ì„ 2ì˜ í´ë”ì— ì˜®ê¸´ë‹¤!

```python
import pandas as pd

df = pd.read_csv('./data/movies.csv')

display(df)
```



![20-09-10-img(2)](/assets/images/post/development/200910/20-09-10-img(2).jpg)



ìœ„ìª½, ë˜ëŠ” ì•„ë˜ìª½ì˜ í–‰ë§Œ ì¶œë ¥í•˜ë ¤ë©´?

```python
# ìœ„ìª½ 5ê°œ í–‰ë§Œ ì¶œë ¥í•  ë•Œ
display(df.head())

# ì•„ë˜ìª½ 5ê°œ í–‰ë§Œ ì¶œë ¥í•  ë•Œ
display(df.tail())
```



![20-09-10-img(3)](/assets/images/post/development/200910/20-09-10-img(3).jpg)





#### 2) DataBase(DB) íŒŒì¼ì„ ì´ìš©í•˜ì—¬ ìƒì„± (ë§¥ ë²„ì „)

MySQLì´ë¼ëŠ” DBMSë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ êµ¬ì¶•í•˜ê³  ê·¸ ì•ˆì— ìˆëŠ” ë°ì´í„°ë¥¼ ì¶”ì¶œí•´ì„œ DataFrameìœ¼ë¡œ ìƒì„±í•  ê²ƒì´ë‹¤.

1.  MySQL ì‚¬ì´íŠ¸ì—ì„œ ì„¤ì¹˜í•˜ê±°ë‚˜ í™ˆë¸Œë£¨ë¥¼ ì´ìš©í•˜ì—¬ MySQLì„ ì„¤ì¹˜í•œë‹¤. 

```python
brew install mysql
```

2. í„°ë¯¸ë„ì„ ì¼œê³  ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ MySQL DBMS Serverë¥¼ ì‹¤í–‰í•œë‹¤

```pyhon
mysql.server start
```

2.2 ì¢…ë£Œ 

```python
mysql.server stop
```

3. ìœ ì € ê¶Œí•œìœ¼ë¡œ ì½˜ì†”ì— ì ‘ê·¼í•œë‹¤

```python
mysql -u root
```

4. ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ìƒì„±í•œë‹¤

```python
create user data identified by 'data';
```

5. ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ í•˜ë‚˜ ë” ìƒì„±í•œë‹¤

```python
create user data@localhost identified by 'data';
```

6. ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤

```python
create database library;
```

7. ìƒì„±í•œ ë°ì´í„°ë² ì´ìŠ¤(library)ì— ëŒ€í•œ ì‚¬ìš©ê¶Œí•œì„ ìƒˆë¡­ê²Œ ìƒì„±í•œ data ì‚¬ìš©ìì—ê²Œ ë¶€ì—¬í•œë‹¤

```python
grant all privileges on library.* to data;
```

8. ìƒì„±í•œ ì‚¬ìš©ìê°€ data@localhosteì—ë„ ìˆê¸°ë•Œë¬¸ì— ì‚¬ìš©ê¶Œí•œì„ ë˜‘ê°™ì´ ë¶€ì—¬í•œë‹¤

```python
grant all privileges on library.* to data@localhost;
```

9. ì§€ê¸ˆê¹Œì§€ ì‘ì—…í•œ ê¶Œí•œë¶€ì—¬ ì‘ì—…ì„ flushí•œë‹¤

```python
flush privileges;
```

10. ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìœ¼ë‹ˆ ì½˜ì†”ì„ ì¢…ë£Œí•œë‹¤

```python
exit;
```



ì œê³µëœ íŒŒì¼ì„ ì´ìš©í•´ì„œ ì‹¤ì œ ì‚¬ìš©í•  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ êµ¬ì¶•í•´ë³´ì!

11. ì‚¬ìš©í•  íŒŒì¼ì„ MySQLì´ ìœ„ì¹˜í•œ í´ë”ì— ë³µì‚¬í•œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í„°ë¯¸ë„ì— ì‹¤í–‰í•œë‹¤

```python
mysql -u data -p library < _BookTableDump.sql
```



ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶•ì´ ëë‚¬ìœ¼ë‹ˆ Pandasë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†í•´ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ DataFrameì„ ë§Œë“¤ì–´ë³´ì.

```python
import pymysql.cursors
import pandas as pd

# pymysqlì´ë¼ëŠ” moduleì„ ì´ìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•  ê²ƒì´ë‹¤

conn = pymysql.connect(host='localhost',
                       user='data',
                       password='data',
                       db='library',
                       charset='utf8')

# ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†ë˜ë©´ SQLë¬¸ì„ ì‹¤í–‰ì‹œì¼œì„œ Databaseë¡œë¶€í„°
# ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ DataFrameìœ¼ë¡œ ìƒì„±
# bookì´ë€ ì´ë¦„ì˜ í…Œì´ë¸”ì—ì„œ btitle, bauthor, bpriceë¥¼ ê°€ì ¸ì˜¤ë¼ëŠ” ëœ»

sql = 'select btitle, bauthor, bprice from book'

df = pd.read_sql(sql, con=conn)

display(df)

```



![20-09-10-img(4)](/assets/images/post/development/200910/20-09-10-img(4).jpg)



SQL êµ¬ë¬¸ì„ ì´ìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì•ˆì˜ ë°ì´í„°ë¥¼ ìƒì„¸í•˜ê²Œ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.

1. 3ë§Œì›ì´ ì´ˆê³¼í•˜ëŠ” ì±…ë“¤ë§Œ ë¶ˆëŸ¬ì˜¤ê³  ì‹¶ë‹¤

```python
sql = 'select btitle, bauthor, bprice from book where bprice > 30000'
```

2. ì±… ì œëª©ì— 'java' í‚¤ì›Œë“œê°€ ë“¤ì–´ê°€ ìˆëŠ” ì±…ë“¤ë§Œ ë¶ˆëŸ¬ì˜¤ê³  ì‹¶ë‹¤

```python
sql 'select btitle, bauthor, bprice from book where btitle like "%java%" '
```



#### 3) JSON íŒŒì¼ì„ ì´ìš©í•˜ì—¬ ìƒì„±

ë²ˆì™¸) with êµ¬ë¬¸ ì´ìš©í•˜ì—¬ DataFrameì„ JSON íŒŒì¼ë¡œ ì €ì¥í•˜ê¸°

`ì£¼ì˜ì ` 

* unicodeë¡œ íŒŒì¼ì„ ìƒì„±í•œ í›„ ë°ì´í„°ë¥¼ ì €ì¥í•´ì•¼ í•œê¸€ì´ ì •ìƒì²˜ë¦¬ê°€ ëœë‹¤
* íŒŒì¼ì„ ì €ì¥ í•  í´ë”ëŠ” ë¯¸ë¦¬ ìƒì„± ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤

```python
with open('./data/json/books_columns_json', 'w', encoding=utf-8') as file:
          df.to_json(file, force_ascii=False, orient='columns')
          # orient = columnsë¡œ ì„¤ì •í•˜ë©´ dfì˜ columnsì´ JSONì˜ keyê°’ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤
          
with open('./data/json/books_records_json', 'w', encoding='utf-8') as file:
    df.to_json(file, force_ascii=False, orient='records')
    
with open('./data/json/books_index_json', 'w', encoding='utf-8') as file:
    df.to_json(file, force_ascii=False, orient='index')
    
with open('./data/json/books_values_json', 'w', encoding='utf-8') as file:
    df.to_json(file, force_ascii=False, orient='values')          
```



'columns'

![20-09-10-img(5)](/assets/images/post/development/200910/20-09-10-img(5).jpg)

'records'

![20-09-10-img(6)](/assets/images/post/development/200910/20-09-10-img(6).jpg)

'index'

![20-09-10-img(7)](/assets/images/post/development/200910/20-09-10-img(7).jpg)

'values'

![20-09-10-img(8)](/assets/images/post/development/200910/20-09-10-img(8).jpg)



ìƒì„±ëœ JSONì˜ êµ¬ì¡°ê°€ ì¡°ê¸ˆì”© ë‹¤ë¥¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ìœ„ì—ì„œ orient = columnsë¡œ ìƒì„±í•œ JSON íŒŒì¼ì„ ì½ì–´ì„œ DataFrameì„ ìƒì„±í•´ë³´ì.

```python
import numpy as np
import pandas as pd
import json

with open('./data/json/books_columns_json', 'r',
         encoding=utf-8) as file:
         dict_books = json.load(file)
    
df = pd.DataFrame(dict_books)
display(df)
```





#### 4) Open APIë¥¼ ì´ìš©í•´ì„œ ìƒì„±

ì¼ì¼ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ìˆœìœ„ë¥¼ ì•Œë ¤ì£¼ëŠ” [ì˜í™”ì§„í¥ìœ„ì›íšŒ API](http://www.kobis.or.kr/kobisopenapi/homepg/apiservice/searchServiceInfo.do)ë¥¼ ì´ìš©í•´ì„œ DataFrameì„ ë¶ˆëŸ¬ì˜¤ì.

Open APIëŠ” ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í†µí•´ì„œ í˜¸ì¶œí•œë‹¤.



```python
import numpy as np
import pandas as pd
import json
import urllib

# í˜¸ì¶œí•  open api url 
openapi_url = 'http://www.kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=dcc8cb114359e2c52eb06dba68ef03ac&targetDt=20200909' 


# requestë¥¼ ë³´ëƒˆìœ¼ë‹ˆ responseê°€ ì˜¨ë‹¤
# load_page => response ê°ì²´
load_page = urllib.request.urlopen(openapi_url)

# open apiì—ì„œ ë¶ˆëŸ¬ì˜¨ dictionary ì¶”ì¶œ
json_page = json.load(load_page.read())

```

í•´ë‹¹ ë°ì´í„°ì—ì„œ 

* Index : ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ìˆœìœ„ (rank)
* Value : ì˜í™”ì œëª© (movieNm) / ëˆ„ì  ë§¤ì¶œì•¡ (salesAcc)

ìœ¼ë¡œ í•˜ëŠ” DataFrameì„ ë§Œë“¤ê³ ì í•œë‹¤.



![20-09-10-img(9)](/assets/images/post/development/200910/20-09-10-img(9).jpg)



dictionaryì˜ ê°€ì¥ í° ì¹´í…Œê³ ë¦¬ëŠ” 'boxOfficeResult'ì´ê³  ê·¸ ì•ˆì— 'dailyBoxOfficeList'ê°€ ìˆë‹¤. ì´ ì•ˆì— ë‚´ê°€ í•„ìš”ë¡œ í•˜ëŠ” 'rank', 'movieNm', 'salesAcc'... ë“±ì´ í¬í•¨ë˜ì–´ ìˆë‹¤. 

ì´ëŸ° dictionaryë¥¼ nested dictionary(ì¤‘ì²© ë”•ì…”ë„ˆë¦¬)ë¼ê³  í•œë‹¤.

ê³„ì¸µí˜•ìœ¼ë¡œ ë˜ì–´ìˆëŠ” ë°ì´í„°ì— ì ‘ê·¼í•  ë•Œì—ëŠ” ë‹¨ê³„ë§Œí¼ ëŒ€ê´„í˜¸ë¥¼ ì¨ì¤€ë‹¤.

ì²«ë²ˆì§¸ë¡œ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ìˆœìœ„ë¥¼ listë¡œ ë§Œë“¤ê¸° ìœ„í•´ forë¬¸ì„ ì‘ì„±í•œë‹¤.

```python
list_R = [d['rank'] for d in json_page['boxOfficeResult']['dailyBoxOfficeList']]

print(list_R)
#['1', '2', '3', '4', '5', '6', '7', '8', '9', '10']
```



ë‘ë²ˆì§¸ë¡œ valuesë¥¼ ì˜í™”ì œëª©ê³¼ ì´ ë§¤ì¶œì•¡ì„ ì¶”ì¶œí•œë‹¤.

```python
movie_values = [ [d['movieNm'],d['salesAcc']] for d in json_page['boxOfficeResult']['dailyBoxOfficeList']]

print(movie_values)
```



dictionaryì—ì„œ ì¶”ì¶œí•œ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ DataFrameì„ ìƒì„±í•œë‹¤.

```python
movie_df = pd.DataFrame(movie_values,
                        columns=['ì˜í™”ì œëª©', 'ì´ë§¤ì¶œì•¡'],
                        index=list_R)

display(movie_df)

```



![20-09-10-img(10)](/assets/images/post/development/200910/20-09-10-img(10).jpg)



ì •ë¦¬ëŠ” ì €ë²ˆì— ëë‚´ê³  ì—…ë¡œë“œë¥¼ ì´ì œ í•˜ë‹¤ë‹ˆ ã…œã…œã…œ ì£¼ë§ ì´ìš©í•´ì„œ ë§ˆì € Pandas ì •ë¦¬ë¥¼ ëë‚´ì•¼ê² ë‹¤!!





